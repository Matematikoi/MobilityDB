<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>Spatial Relationships</title><link rel="stylesheet" type="text/css" href="docbook.css"><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot"><link rel="home" href="index.html" title="MobilityDB 1.1 User's Manual"><link rel="up" href="ch08.html" title="Chapter 8. Temporal Types: Spatial Operations"><link rel="prev" href="ch08s06.html" title="Distance Operations"><link rel="next" href="ch09.html" title="Chapter 9. Temporal Types: Analytics Operations"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Spatial Relationships</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch08s06.html">Prev</a> </td><th width="60%" align="center">Chapter 8. Temporal Types: Spatial Operations</th><td width="20%" align="right"> <a accesskey="n" href="ch09.html">Next</a></td></tr></table><hr></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="tpoint_spatial_rel"></a>Spatial Relationships</h2></div></div></div><p>The topological relationships such as <code class="varname">ST_Intersects</code> and the distance relationships such as <code class="varname">ST_DWithin</code> can be generalized for temporal points. The arguments of these generalized functions are either a temporal point and a base type (that is, a <code class="varname">geometry</code> or a <code class="varname">geography</code>) or two temporal points. Furthermore, both arguments must be of the same base type, that is, these functions do not allow to mix a temporal geometry point (or a geometry) and a temporal geography point (or a geography).</p><p>There are two versions of the spatial relationships:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The <span class="emphasis"><em>ever relationships</em></span> determine whether the topological or distance relationship is ever satisfied (see <a class="xref" href="ch06s03.html#ever_always_comparison" title="Ever and Always Comparisons">the section called “Ever and Always Comparisons”</a>) and returns a <code class="varname">boolean</code>. Examples are the <code class="varname">eintersects</code> and <code class="varname">edwithin</code> functions.</p></li><li class="listitem"><p>The <span class="emphasis"><em>temporal relationships</em></span> compute the topological or distance relationship at each instant and results in a <code class="varname">tbool</code>. Examples are the <code class="varname">tintersects</code> and <code class="varname">tdwithin</code> functions.</p></li></ul></div><p>
				For example, the following query
		</p><pre class="programlisting">
SELECT eintersects(geometry 'Polygon((1 1,1 3,3 3,3 1,1 1))',
  tgeompoint '[Point(0 2)@2001-01-01, Point(4 2)@2001-01-05)');
-- t
</pre><p>
			tests whether the temporal point ever intersects the geometry. In this case, the query is equivalent to the following one
		</p><pre class="programlisting">
SELECT ST_Intersects(geometry 'Polygon((1 1,1 3,3 3,3 1,1 1))',
  geometry 'Linestring(0 2,4 2)');
</pre><p>
			where the second geometry is obtained by applying the <code class="varname">trajectory</code> function to the temporal point. In contrast, the query
		</p><pre class="programlisting">
SELECT tintersects(geometry 'Polygon((1 1,1 3,3 3,3 1,1 1))',
  tgeompoint '[Point(0 2)@2001-01-01, Point(4 2)@2001-01-05)');
-- {[f@2001-01-01, t@2001-01-02, t@2001-01-04], (f@2001-01-04, f@2001-01-05)}
</pre><p>
			computes at each instant whether the temporal point intersects the geometry. Similarly, the following query
		</p><pre class="programlisting">
SELECT edwithin(tgeompoint '[Point(3 1)@2001-01-01, Point(5 1)@2001-01-03)',
  tgeompoint '[Point(3 1)@2001-01-01, Point(1 1)@2001-01-03)', 2);
-- t
</pre><p>
			tests whether the distance between the temporal points was ever less than or equal to 2, while the following query
		</p><pre class="programlisting">
SELECT tdwithin(tgeompoint '[Point(3 1)@2001-01-01, Point(5 1)@2001-01-03)',
  tgeompoint '[Point(3 1)@2001-01-01, Point(1 1)@2001-01-03)', 2);
-- {[t@2001-01-01, t@2001-01-02], (f@2001-01-02, f@2001-01-03)}
</pre><p>
			computes at each instant whether the distance between the temporal points is less than or equal to 2.
		</p><p>
		The ever relationships are sometimes used in combination with a spatiotemporal index when computing the temporal relationships. For example, the following query
		</p><pre class="programlisting">
SELECT T.TripId, R.RegionId, tintersects(T.Trip, R.Geom)
FROM Trips T, Regions R
WHERE eintersects(T.Trip, R.Geom)
</pre><p>
			which verifies whether a trip <code class="varname">T</code> (which is a temporal point) intersects a region <code class="varname">R</code> (which is a geometry), will benefit from a spatiotemporal index on the column <code class="varname">T.Trip</code> since the <code class="varname">eintersects</code> function will automatically perform the bounding box comparison <code class="varname">T.Trip &amp;&amp; R.Geom</code>. This is further explained later in this document.
		</p><p>Not all spatial relationships available in PostGIS have a meaningful generalization for temporal points. A generalized version of the following relationships are defined for temporal geometric points: <code class="varname">eintersects</code>, <code class="varname">edisjoint</code>, <code class="varname">edwithin</code>, <code class="varname">econtains</code>, and <code class="varname">etouches</code>, while for temporal geographic points only the three first ones are defined. Furthermore, not all combinations of parameters are meaningful for a given generalized function. For example, while <code class="varname">tcontains(geometry, tpoint)</code> is meaningful, <code class="varname">tcontains(tpoint, geometry)</code> is meaningful only when the geometry is a single point, and <code class="varname">tcontains(tpoint, tpoint)</code> is equivalent to <code class="varname">tintersects(tpoint, geometry)</code>. For this reason, only the first combination of parameters is defined for <code class="varname">econtains</code> and <code class="varname">tcontains</code>.</p><p>Finally, it is worth noting that the temporal relationships allow to mix 2D/3D geometries but in that case, the computation is only performed on 2D.</p><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="idm4713"></a>Ever Spatial Relationships</h3></div></div></div><p>We present next the ever spatial relationships. All of them automatically include a bounding box comparison that makes use of any spatial indexes that are available on the arguments.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a name="econtains"></a><a class="indexterm" name="idm4718"></a><p>Ever contains</p><p><code class="varname">econtains(geo,tgeompoint) → boolean</code></p><p>This function returns true if the temporal point is ever at the interior of the geometry. Recall that a geometry does not contain things in its boundary and thus, polygons and lines do not contain lines and points lying in their boundary.  Please refer to the documentation of the <a class="ulink" href="https://postgis.net/docs/ST_Contains.html" target="_top">ST_Contains</a> function in PostGIS.</p><pre class="programlisting">
SELECT econtains(geometry 'Linestring(1 1,3 3)',
  tgeompoint '[Point(4 2)@2000-01-01, Point(2 4)@2000-01-02]');
-- false
SELECT econtains(geometry 'Linestring(1 1,3 3,1 1)',
  tgeompoint '[Point(4 2)@2000-01-01, Point(2 4)@2000-01-03]');
-- true
SELECT econtains(geometry 'Polygon((1 1,1 3,3 3,3 1,1 1))',
 tgeompoint '[Point(0 1)@2000-01-01, Point(4 1)@2000-01-02]');
-- false
SELECT econtains(geometry 'Polygon((1 1,1 3,3 3,3 1,1 1))',
  tgeompoint '[Point(1 4)@2000-01-01, Point(4 1)@2000-01-04]');
-- true
</pre></li><li class="listitem"><a name="edisjoint"></a><a class="indexterm" name="idm4728"></a><p>Is ever disjoint <span class="inlinemediaobject"><img src="images/cube.svg" width="13"></span>
 <span class="inlinemediaobject"><img src="images/world.svg" width="13"></span>
</p><p><code class="varname">edisjoint({geo,tpoint},{geo,tpoint}) → boolean</code></p><pre class="programlisting">
SELECT edisjoint(geometry 'Polygon((0 0,0 1,1 1,1 0,0 0))',
  tgeompoint '[Point(0 0)@2001-01-01, Point(1 1)@2001-01-03)');
-- false
SELECT edisjoint(geometry 'Polygon((0 0 0,0 1 1,1 1 1,1 0 0,0 0 0))',
  tgeompoint '[Point(0 0 1)@2001-01-01, Point(1 1 0)@2001-01-03)');
-- true
</pre></li><li class="listitem"><a name="edwithin"></a><a class="indexterm" name="idm4750"></a><p>Is ever at distance within <span class="inlinemediaobject"><img src="images/cube.svg" width="13"></span>
 <span class="inlinemediaobject"><img src="images/world.svg" width="13"></span>
</p><p><code class="varname">edwithin({geo,tpoint},{geo,tpoint},float) → boolean</code></p><pre class="programlisting">
SELECT edwithin(geometry 'Point(1 1 1)',
  tgeompoint '[Point(0 0 0)@2000-01-01, Point(1 1 0)@2000-01-02]', 1);
-- true
SELECT edwithin(geometry 'Polygon((0 0 0,0 1 1,1 1 1,1 0 0,0 0 0))',
  tgeompoint '[Point(0 2 2)@2000-01-01,Point(2 2 2)@2000-01-02]', 1);
-- false
</pre></li><li class="listitem"><a name="eintersects"></a><a class="indexterm" name="idm4772"></a><p>Ever intersects <span class="inlinemediaobject"><img src="images/cube.svg" width="13"></span>
 <span class="inlinemediaobject"><img src="images/world.svg" width="13"></span>
</p><p><code class="varname">eintersects({geo,tpoint},{geo,tpoint}) → boolean</code></p><pre class="programlisting">
SELECT eintersects(geometry 'Polygon((0 0 0,0 1 0,1 1 0,1 0 0,0 0 0))',
  tgeompoint '[Point(0 0 1)@2001-01-01, Point(1 1 1)@2001-01-03)');
-- false
SELECT eintersects(geometry 'Polygon((0 0 0,0 1 1,1 1 1,1 0 0,0 0 0))',
  tgeompoint '[Point(0 0 1)@2001-01-01, Point(1 1 1)@2001-01-03)');
-- true
</pre></li><li class="listitem"><a name="etouches"></a><a class="indexterm" name="idm4794"></a><p>Ever touches <span class="inlinemediaobject"><img src="images/cube.svg" width="13"></span>
</p><p><code class="varname">etouches({geo,tgeompoint},{geo,tgeompoint}) → boolean</code></p><pre class="programlisting">
SELECT etouches(geometry 'Polygon((0 0,0 1,1 1,1 0,0 0))',
  tgeompoint '[Point(0 0)@2001-01-01, Point(0 1)@2001-01-03)');
-- true
</pre></li></ul></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="idm4808"></a>Temporal Spatial Relationships</h3></div></div></div><p>We present next the temporal spatial relationships. A common requirement regarding them is to restrict the result of the relationship to the instants when the value of the result is true or false. As an example, the following query computes for each trip the time spent traveling in the Brussels municipality.</p><pre class="programlisting">
SELECT TripId, duration(atValue(tintersects(T.trip, M.geom), True))
FROM Trips T, Municipality M
WHERE M.Name = "Brussels" AND atValue(tintersects(T.trip, M.geom), True) IS NOT NULL;
</pre><p>To simplify query writing, the temporal spatial relationships have an optional last parameter, which if given applies the <code class="varname">atValue</code> function (see <a class="xref" href="ch06s02.html" title="Restrictions">the section called “Restrictions”</a>) to the result of the relationship. In this way, the above query can be written as follows.</p><pre class="programlisting">
SELECT TripId, duration(tintersects(T.trip, M.geom, True))
FROM Trips T, Municipality M
WHERE M.Name = "Brussels" AND tintersects(T.trip, M.geom, True) IS NOT NULL;
</pre><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a name="tcontains"></a><a class="indexterm" name="idm4818"></a><p>Temporal contains</p><p><code class="varname">tcontains(geometry,tgeompoint,atValue boolean=NULL) → tbool</code></p><pre class="programlisting">
SELECT tcontains(geometry 'Linestring(1 1,3 3)',
  tgeompoint '[Point(4 2)@2000-01-01, Point(2 4)@2000-01-02]');
-- {[f@2000-01-01, f@2000-01-02]}
SELECT tcontains(geometry 'Linestring(1 1,3 3,1 1)',
  tgeompoint '[Point(4 2)@2000-01-01, Point(2 4)@2000-01-03]');
-- {[f@2000-01-01, t@2000-01-02], (f@2000-01-02, f@2000-01-03]}
SELECT tcontains(geometry 'Polygon((1 1,1 3,3 3,3 1,1 1))',
  tgeompoint '[Point(0 1)@2000-01-01, Point(4 1)@2000-01-02]');
-- {[f@2000-01-01, f@2000-01-02]}
SELECT tcontains(geometry 'Polygon((1 1,1 3,3 3,3 1,1 1))',
  tgeompoint '[Point(1 4)@2000-01-01, Point(4 1)@2000-01-04]');
-- {[f@2000-01-01, f@2000-01-02], (t@2000-01-02, f@2000-01-03, f@2000-01-04]}
</pre></li><li class="listitem"><a name="tdisjoint"></a><a class="indexterm" name="idm4826"></a><p>Temporal disjoint <span class="inlinemediaobject"><img src="images/cube.svg" width="13"></span>
 <span class="inlinemediaobject"><img src="images/world.svg" width="13"></span>
</p><p><code class="varname">tdisjoint({geo,tpoint},{geo,tpoint},atValue boolean=NULL) → tbool</code></p><p>The function only supports 3D or geographies for two temporal points</p><pre class="programlisting">
SELECT tdisjoint(geometry 'Polygon((1 1,1 2,2 2,2 1,1 1))',
  tgeompoint '[Point(0 0)@2001-01-01, Point(3 3)@2001-01-04)');
-- {[t@2001-01-01, f@2001-01-02, f@2001-01-03], (t@2001-01-03, t@2001-01-04]}
SELECT tdisjoint(tgeompoint '[Point(0 3)@2001-01-01, Point(3 0)@2001-01-05)',
  tgeompoint '[Point(0 0)@2001-01-01, Point(3 3)@2001-01-05)');
-- {[t@2001-01-01, f@2001-01-03], (t@2001-01-03, t@2001-01-05)}
</pre></li><li class="listitem"><a name="tdwithin"></a><a class="indexterm" name="idm4849"></a><p>Temporal distance within <span class="inlinemediaobject"><img src="images/cube.svg" width="13"></span>
</p><p><code class="varname">tdwithin({geompoint,tgeompoint},{geompoint,tgeompoint},float,atValue boolean=NULL)</code></p><p><code class="varname">  → tbool</code></p><pre class="programlisting">
SELECT tdwithin(geometry 'Point(1 1)',
  tgeompoint '[Point(0 0)@2001-01-01, Point(2 2)@2001-01-03)', sqrt(2));
--  {[t@2001-01-01, t@2001-01-03)}
SELECT tdwithin(tgeompoint '[Point(1 0)@2000-01-01, Point(1 4)@2000-01-05]',
  tgeompoint 'Interp=Step;[Point(1 2)@2000-01-01, Point(1 3)@2000-01-05]', 1);
-- {[f@2000-01-01, t@2000-01-02, t@2000-01-04], (f@2000-01-04, t@2000-01-05]}
</pre></li><li class="listitem"><a name="tintersects"></a><a class="indexterm" name="idm4866"></a><p>Temporal intersects <span class="inlinemediaobject"><img src="images/cube.svg" width="13"></span>
 <span class="inlinemediaobject"><img src="images/world.svg" width="13"></span>
</p><p><code class="varname">tintersects({geo,tpoint},{geo,tpoint},atValue boolean=NULL) → tbool</code></p><p>The function only supports 3D or geographies for two temporal points</p><pre class="programlisting">
SELECT tintersects(geometry 'MultiPoint(1 1,2 2)',
  tgeompoint '[Point(0 0)@2001-01-01, Point(3 3)@2001-01-04)');
/* {[f@2001-01-01, t@2001-01-02], (f@2001-01-02, t@2001-01-03],
   (f@2001-01-03, f@2001-01-04]} */
SELECT tintersects(tgeompoint '[Point(0 3)@2001-01-01, Point(3 0)@2001-01-05)',
  tgeompoint '[Point(0 0)@2001-01-01, Point(3 3)@2001-01-05)');
-- {[f@2001-01-01, t@2001-01-03], (f@2001-01-03, f@2001-01-05)}
</pre></li><li class="listitem"><a name="ttouches"></a><a class="indexterm" name="idm4889"></a><p>Temporal touches</p><p><code class="varname">ttouches({geo,tgeompoint},{geo,tgeompoint},atValue boolean=NULL) → tbool</code></p><pre class="programlisting">
SELECT ttouches(geometry 'Polygon((1 0,1 2,2 2,2 0,1 0))',
  tgeompoint '[Point(0 0)@2001-01-01, Point(3 0)@2001-01-04)');
-- {[f@2001-01-01, t@2001-01-02, t@2001-01-03], (f@2001-01-03, f@2001-01-04]}
</pre></li></ul></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch08s06.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="ch08.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="ch09.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Distance Operations </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> Chapter 9. Temporal Types: Analytics Operations</td></tr></table></div></body></html>
